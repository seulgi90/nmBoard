<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<!--   <meta charset="utf-8"> -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Type" content="text/html; charset=EUC-KR">
  <title>NM 게시판 </title>
  
  <style>
  table, th, td {
  border: 1px solid;
  }
  </style>
  
</head>	

<body>

<form id="detail" enctype="multipart/form-data">
	<table>
   		<tr>
		 <th>번호</th>
		 <td><input type="text" name="no" th:value="${detailBoard.no}" readonly></td>
		</tr>
		<tr>
		 <th>제목</th>
		 <td><input type="text" name="title" th:value="${detailBoard.title}"  id="title"></td>
		</tr>
		<tr>
		 <th>내용</th>
		 <td><textarea name="content" cols="30" rows="5" th:text="${detailBoard.content}"  id="content"></textarea></td>
		</tr>
		
  <tr>
     <th>첨부파일</th>
         <td>
            <ul>
               <li th:each="file : ${detailBoard.attachedFiles}">
                 <a th:href="@{/board/files/{path}(path=${file.filepath})}" th:text="${file.filepath}"></a>
               </li>
             </ul> 
                 파일 추가: <input name='files' type="file" multiple>
         </td>
  </tr>
		<!-- 로그인한 유저(detailBoard.userNo) == 작성자(detailBoard.writer.userNo) 일치 여부 확인 -->
  		<input type="hidden" name="userNo" th:value="${detailBoard.writer.userNo}">
		<input type="hidden" name="userNo" th:value="${detailBoard.userNo}">
   
	</table>
		<button type="button" onclick="update(this.form)">수정</button>
		<button type="button" th:onclick="'deleteBoard(' + ${detailBoard.no} + ');'">삭제</button>
		<button type="button" th:onclick="location.href='/board/boardlist'">목록</button>
      
	</form>
	

</body>

<script src="http://code.jquery.com/jquery-latest.min.js"></script>

<script>
function update(form) {
	
	let updateBoard = $("#detail").serialize();
	
	let result = confirm('글을 수정하시겠습니까?');
	
	let titleCheck =  document.getElementById('title').value;
	let contentCheck =  document.getElementById('content').value;
	
	if(result == true) {
		
		if(titleCheck == "") {
			alert("제목 입력 필수");
			return false;
		}
		if(contentCheck == "") {
			alert("내용 입력 필수");
			return false;
		}
		
		$.ajax({
			type : "post",
			url : "updateboard",
			data : updateBoard,
			dataType : "text",
			success : function(data) {
				
				let updateBoard = JSON.parse(data);
				
				if(updateBoard.status > 0) {
					
					alert('글 수정 성공');
	 				window.location.href = "/board/detail?no=" + updateBoard.boardNo;
				}
				
			}
		}); // ajax
		
	} else {
		
		alert('글 수정 취소');
	}
}

function deleteBoard(no) {
	
	let deleteBoard = $("#detail").serialize();
	
	let result = confirm('글을 삭제 하시겠습니까?');
	
	if(result == true) {
		
		$.ajax({
			type : "post",
			url : "deleteboard",
			data : deleteBoard,
			dataType : "text",
			success : function(data) {
				
				let deleteBoard = JSON.parse(data);
				
				if(deleteBoard.status > 0) {
					
					alert('글 삭제 성공');
	 				window.location.href = "/board/boardlist";
				}
				
			}
		}); // ajax
		
	} else {
		alert('글 삭제 취소');
	}
	
 }
 
 
</script>
</html>